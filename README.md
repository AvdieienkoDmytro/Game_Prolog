# Game_Prolog — K в ряд (падіння)

Логічна гра "K в ряд" з гравітаційною механікою (аналог Connect 4).  
Рушій реалізовано на **SWI-Prolog** та **Haskell**. Веб-інтерфейс використовує **Tau-Prolog** — Prolog-інтерпретатор у браузері, тому вся ігрова логіка (MinMax, Alpha-Beta, перевірка виграшу) залишається справжнім Prolog-кодом.

**Автор:** Авдєєнко Дмитро Максимович  
**Курс:** Логічне програмування · SWI-Prolog  
**Демо:** [https://avdieienkodmytro.github.io/Game_Prolog](https://avdieienkodmytro.github.io/Game_Prolog)

---

## Структура репозиторію

```
Game_Prolog/
├── web/
│   └── index.html          # Веб-інтерфейс (Tau-Prolog в браузері)
├── src/
│   ├── prolog/
│   │   ├── kinariad.pl     # Основний SWI-Prolog рушій (локальний запуск)
│   │   └── kinariad_tau.pl # Адаптація для Tau-Prolog (браузер)
│   └── haskell/
│       └── KInARow.hs      # Порівняльна реалізація на Haskell
├── docs/
│   └── (презентація, нотатки)
└── README.md
```

---

## Правила гри

- Поле **n×m** (n ≥ 5, m ≥ 6)
- **K ∈ {3, 4, 5}** — кількість фішок в ряд для виграшу
- Фішки **падають** під дією гравітації до нижнього вільного рядка стовпця
- Підтримуються **заборонені клітини** — перешкоди на полі

---

## Веб-інтерфейс

GitHub Pages обслуговує статичний сайт. При завантаженні `index.html` браузер отримує `kinariad_tau.pl` через `fetch()` і передає його Tau-Prolog. Далі всі запити до рушія — це звичайні Prolog-запити виду:

```javascript
session.query("js_ai_move(BoardAtom, x, 6, NewBoard, Col, Result)");
```

### Режими гри

| Режим | X | O |
|-------|---|---|
| Людина – Людина | Гравець | Гравець |
| Людина – Prolog | Гравець | ШІ |
| Prolog – Людина | ШІ | Гравець |
| Prolog – Prolog | ШІ | ШІ |

---

## Локальний запуск (SWI-Prolog)

```prolog
?- [src/prolog/kinariad].

% Нова гра 6x7, k=4, без заборонених клітин
?- new_game(6, 7, 4, [], B), print_board(B).

% Хід людини у стовпець 4
?- new_game(6, 7, 4, [], B0),
   human_move(B0, 4, x, B1),
   print_board(B1).

% Хід ШІ (глибина 6 пів-ходів)
?- new_game(6, 7, 4, [], B0),
   prolog_move(B0, x, 6, B1, Col),
   format("ШІ -> стовпець ~w~n", [Col]),
   print_board(B1).

% Із забороненими клітинами
?- new_game(6, 7, 4, [(3,3),(3,4)], B), print_board(B).
```

---

## Ключові предикати

| Предикат | Індикатори | Призначення |
|----------|-----------|-------------|
| `new_game/5` | `++,++,++,++,--` | Створення дошки |
| `drop_piece/5` | `++,++,++,--,--` | Падіння фішки (гравітація) |
| `col_available/2` | `++,++` | Перевірка доступності стовпця |
| `winner/4` | `++,++,++,--` | Перевірка виграшу після ходу |
| `win_exists/2` | `++,++` | Наявність виграшної позиції |
| `minimax/7` | `++,++,++,++,++,++,--` | MinMax + Alpha-Beta |
| `best_move/4` | `++,++,++,--` | Вибір ходу ШІ |

Детальний аналіз мультипризначенності кожного предиката — у коментарях `src/prolog/kinariad.pl`.

---

## Порівняння реалізацій

| Критерій | Prolog | Haskell | Python (іл.) |
|----------|--------|---------|--------------|
| Представлення дошки | Term `board/5`, плаский список | Record `Board`, `[[Cell]]` | `list[list]` |
| Оновлення стану | `replace_nth1` (без мутації) | List comprehension | Мутація `board[r][c]` |
| MinMax | Клаузи + збій Prolog | Рекурсивні функції + `Maybe` | Явний стек / рекурсія |
| Мультипризначенність | Вбудована (±напрямки) | Відсутня | Відсутня |
| Генерація ходів | `findall` (декларативно) | List comprehension | `for` цикл |
| Швидкість | ~10× повільніше Python | ~2-3× повільніше Python | Базова |

### Обґрунтування CLP

CLP(FD) не застосовано. MinMax — це пошук у дереві гри, а не задача виконання обмежень (CSP). Змінні ходу не є FD-змінними; пошук ведеться через `findall` / `member` (generate-and-test). CLP доцільний для задач на зразок розкладу або розподілу ресурсів — не для ігрового ШІ.

---

## Alpha-Beta: глибина у пів-ходах

Параметр `Depth` — кількість **пів-ходів** (не повних ходів):

| Глибина (пів-ходи) | Вузлів без A-B | Вузлів з A-B |
|--------------------|---------------|--------------|
| 4 | ~1 300 | ~200 |
| 6 | ~85 000 | ~5 000 |
| 8 | ~5 000 000 | ~80 000 |

*Поле 6×7, k=4. Числа орієнтовні.*

---

## Першоджерела

- Russell S., Norvig P. *Artificial Intelligence: A Modern Approach*, 4th ed., §5 — Adversarial Search and Games
- SWI-Prolog documentation: https://www.swi-prolog.org/pldoc/
- Tau-Prolog: http://tau-prolog.org/
- Власна реалізація: ~100% оригінального коду; ChatGPT використовувався для перевірки коректності Alpha-Beta (~20%)